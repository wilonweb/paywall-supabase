# SaaS blog Markdown with ?extjs14

https://www.youtube.com/watch?v=293ZtCvxh90

## Setup projet

`npx create-next-app@latest`
Yes : TypeScript
Yes : EsLint
Yes : Taillwind
No : Src Directory
Yes : AppRouter
No : import alias

`npm run dev` : pour lancer le projet

Installer [Shadcn](https://ui.shadcn.com/)

`npx shadcn-ui@latest init`

√ Would you like to use TypeScript : yes
√ Which style would you like to use? : Default
√ Which color would you like to use as base color? : Zinc
√ Where is your global CSS file? : app/globals.css
√ Would you like to use CSS variables for colors? : yes
√ Where is your tailwind.config.js located? : tailwind.config.js
√ Configure the import alias for components: @/components
√ Configure the import alias for utils : @/lib/utils
√ Are you using React Server Components? : yes
√ Write configuration to components.json. Proceed? : yes

Ce qui a permis de creer :

- saas-blog\lib\utils.ts
- saas-blog\components.json
- saas-blog\tailwind.config.js

Et on supprime le fichier `saas-blog\tailwind.config.ts`

### Customisation du theme

Rendez vous sur https://ui.shadcn.com/themes
Configuer la customisation et copier le code

Ensuite on le cole a la place du 1er @layerbase present dans `saas-blog\app\globals.css`

Ensuite on recherche un composant a installer comme le boutton `https://ui.shadcn.com/docs/components/button`
On installe le npm
`npx shadcn-ui@latest add button`

on retirer le code de `saas-blog\app\page.tsx` pour y placer un boilerplate

#tips #extenssions
installation de `ES7 React/Redux/Styled-com` pour créer une boilerplate rapidement avec le raccourci `rfc`

Puis on import le composant button dans le code pour voir si ça fonctionne

```js
import { Button } from "@/components/ui/button";
import React from "react";

export default function page() {
  return (
    <div>
      <Button>click</Button>
    </div>
  );
}
```

Ensuite pour installer le darkmode on vas voir le site `https://ui.shadcn.com/docs/dark-mode/next`

Installation de `npm install next-themes`
Puis on copie colle le theme provider dans un fichier que l'on créé `saas-blog\components\ui\theme-provider.tsx`

Puis on ajoute le ThemeProvider dans le Layout
`saas-blog\app\layout.tsx`

En mentionnant l'attribut systeme comme etant `dark`

```js
import "./globals.css";

import { Inter } from "next/font/google";
import type { Metadata } from "next";
import { ThemeProvider } from "@/components/ui/theme-provider";

const inter = Inter({ subsets: ["latin"] });

export const metadata: Metadata = {
  title: "Create Next App",
  description: "Generated by create next app",
};

export default function RootLayout({
  children,
}: {
  children: React.ReactNode,
}) {
  return (
    <html lang="en" suppressHydrationWarning>
      <body className={inter.className}>
        <ThemeProvider
          attribute="class"
          defaultTheme="dark"
          enableSystem
          disableTransitionOnChange
        >
          {children}
        </ThemeProvider>
      </body>
    </html>
  );
}
```

## Navigation Bar

Creation du fichier et dossier `saas-blog\components\ui\nav\NavBar.tsx`
Avec une react icone `https://react-icons.github.io/react-icons/` pris dans `https://react-icons.github.io/react-icons/`
Et découverte de l'attribut variant pour donner du style a notre boutton

`saas-blog\components\ui\nav\NavBar.tsx`

```js
import { Button } from "../button";
import Link from "next/link";
import React from "react";
import { SiGithub } from "react-icons/si";

export default function NavBar() {
  return (
    <nav className="flex items-center justify-between">
      <div className="group">
        <Link href="/" className="text-2-xl font-bold">
          DailyBlog
        </Link>
        <div className="h-1 w-0 group-hover:w-full transition-all bg-green-500"></div>
      </div>
      <Button variant="outline" className="flex items-center gap-2">
        <SiGithub />
        Login
      </Button>
    </nav>
  );
}
```

Ensuite on importe le composant dans `saas-blog\app\layout.tsx`

```js
return (
  /*<html lang="en" suppressHydrationWarning>
      <body className={inter.className}>
        <ThemeProvider
          attribute="class"
          defaultTheme="dark"
          enableSystem
          disableTransitionOnChange
        >*/
  <main className="max-w-7xl mx-auto p-10 space-y-5">
    <NavBar />
    {children}
  </main> /*
        </ThemeProvider>
      </body>
    </html>*/
);
```

## Authentification

On vas implémenter le login avec github
Pour cela rdv sur le projet Supabase > Authentification > Provider est activé Github
Ensuite aller sur https://github.com/settings/profile > Developer settings > OAuthApps
Ce qui mène finalement vers l'url https://github.com/settings/developers
Remplir les information et copier le Client ID et Client Secret généré que l'on colle dans le PrviderGithub de supabse que l'on a activé.
Ensuite aller dans la doc : https://supabase.com/docs/guides/auth/server-side/creating-a-client
Et installer les dépendance npm install @supabase/ssr @supabase/supabase-js
Ensuite créer le fichier `saas-blog\.env.local` pour y coller les variable d'environnement récupérer depuis supabase > project settings > API. https://supabase.com/dashboard/project/liaqsrnwzwmxiybjywqj/settings/api ( on récupere URL est API Keys)

Ensuite on créer le composant `saas-blog\components\ui\nav\LoginForm.tsx` dans lequel on coupe et colle le code du button présent dans `saas-blog\components\ui\nav\NavBar.tsx`.

Ensuite on récupere le code client component de la doc pour exemple https://supabase.com/docs/guides/auth/server-side/creating-a-client pour récuperer les variable d'environnement de l'api supabase et le "use client"
et on ajoute le handleLogin qui déclenche l'authentification quand on clique sur le boutton.

```js
"use client";

import { Button } from "../button";
import React from "react";
import { SiGithub } from "react-icons/si";
import { createBrowserClient } from "@supabase/ssr";
import { usePathname } from "next/navigation";

export default function LoginForm() {
  const pathname = usePathname();
  const supabase = createBrowserClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
  );

  const handleLogin = () => {
    supabase.auth.signInWithOAuth({
      provider: "github",
      options: {
        redirectTo: location.origin + "/auth/callback? next=" + pathname,
      },
    });
  };

  return (
    <Button
      variant="outline"
      className="flex items-center gap-2"
      onClick={handleLogin}
    >
      <SiGithub />
      Login2
    </Button>
  );
}
```

Ensuite on créer les dossiers et le fichier `saas-blog\app\auth\callback\route.ts` pour récupérer la fonction serveur qui gere l'authentification Oauth avec Supabase

Et on le configure grace a la suite de la doc https://supabase.com/docs/guides/auth/server-side/oauth-with-pkce-flow-for-ssr et on configure la route.ts avec le onClick ...

```js
import { cookies } from "next/headers";
import { NextResponse } from "next/server";
import { type CookieOptions, createServerClient } from "@supabase/ssr";

export async function GET(request: Request) {
  const { searchParams, origin } = new URL(request.url);
  const code = searchParams.get("code");
  // if "next" is in param, use it as the redirect URL
  const next = searchParams.get("next") ?? "/";

  if (code) {
    const cookieStore = cookies();
    const supabase = createServerClient(
      process.env.NEXT_PUBLIC_SUPABASE_URL!,
      process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
      {
        cookies: {
          get(name: string) {
            return cookieStore.get(name)?.value;
          },
          set(name: string, value: string, options: CookieOptions) {
            cookieStore.set({ name, value, ...options });
          },
          remove(name: string, options: CookieOptions) {
            cookieStore.delete({ name, ...options });
          },
        },
      }
    );
    const { error } = await supabase.auth.exchangeCodeForSession(code);
    if (!error) {
      return NextResponse.redirect(`${origin}${next}`);
    }
  }

  // return the user to an error page with instructions
  return NextResponse.redirect(`${origin}/auth/auth-code-error`);
}
```

Ensuite on retourne dans la partie creating client de la doc https://supabase.com/docs/guides/auth/server-side/creating-a-client?environment=middleware et on y récupere le MiddleWare que l'on colle dans `saas-blog\middleware.ts` et on le modifie legerment pour ajouter la destructuration de {data} dans pour contenir les information sur la session (null si aucun session est active )

```js
import { createServerClient, type CookieOptions } from "@supabase/ssr";
import { NextResponse, type NextRequest } from "next/server";

export async function middleware(request: NextRequest) {
  let response = NextResponse.next({
    request: {
      headers: request.headers,
    },
  });

  const supabase = createServerClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        get(name: string) {
          return request.cookies.get(name)?.value;
        },
        set(name: string, value: string, options: CookieOptions) {
          request.cookies.set({
            name,
            value,
            ...options,
          });
          response = NextResponse.next({
            request: {
              headers: request.headers,
            },
          });
          response.cookies.set({
            name,
            value,
            ...options,
          });
        },
        remove(name: string, options: CookieOptions) {
          request.cookies.set({
            name,
            value: "",
            ...options,
          });
          response = NextResponse.next({
            request: {
              headers: request.headers,
            },
          });
          response.cookies.set({
            name,
            value: "",
            ...options,
          });
        },
      },
    }
  );

  const { data } = await supabase.auth.getSession(); // Ajout de const {data}
  console.log(data);

  return response;
}

export const config = {
  matcher: [
    /*
     * Match all request paths except for the ones starting with:
     * - _next/static (static files)
     * - _next/image (image optimization files)
     * - favicon.ico (favicon file)
     * Feel free to modify this pattern to include more paths.
     */
    "/((?!_next/static|_next/image|favicon.ico).*)",
  ],
};

```

Ensuite on tres

## Ce que j'ai appris

#tips #extenssions
installation de `ES7 React/Redux/Styled-com` pour créer une boilerplate rapidement avec le raccourci `rfc`
